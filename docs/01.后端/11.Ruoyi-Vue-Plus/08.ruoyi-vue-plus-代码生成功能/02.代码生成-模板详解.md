---
title: ruoyi-vue-plus 代码生成功能 - 模板详解
date: 2023-12-09 21:29:46
author: 柏竹
permalink: /ruoyi-vue-plus/8/template-detail
categories: 
  - 后端
  - 框架
tags: 
  - ruoyi-vue-plus
  - 代码生成
  - velocity
---

## 上下文参数&模板

模板仅在代码当中注释补充展示

### 上下文参数

**通用上下文参数**

| 上下文参数 | 说明 |
| :--------: | :--------: |
|        author    | 作者名 |
|        BusinessName    | 生成业务名，驼峰处理 |
|        businessName    | 生成业务名，无驼峰 |
|        basePackage    | 包前缀 |
|        ClassName    | 类名，驼峰处理 |
|        className    | 类名，无驼峰 |
|        columns    | 表所有列字段 |
|        dicts    | 字典组 (包含有下拉框，单选框，复选框和字典名) |
|        datetime    | 生成时间 |
|        functionName    | 模块描述，功能名 |
|        importList    | 外部引列列表 |
|        moduleName    | 模块名 |
|        packageName    | 包路径 |
|        permissionPrefix    | 权限前缀标识 (模块名:业务名) |
|        pkColumn    | 主键字段对象 |
|        tplCategory    | 模板类型 (单表，树表，sub主子表) |
|        table    | 表对象 |
|        tableName    | 表名 |

### Java模板

**实体对象 vm/java/domain.java.vm**

::: details 点击展开

```velocity {43-53}
package ${packageName}.domain;

import com.baomidou.mybatisplus.annotation.*;
import lombok.Data;
import lombok.EqualsAndHashCode;
import java.io.Serializable;
import java.util.Date;
import java.math.BigDecimal;

#foreach ($import in $importList)
import ${import};
#end
#if($table.crud || $table.sub)
import com.ruoyi.common.core.domain.BaseEntity;
#elseif($table.tree)
import com.ruoyi.common.core.domain.TreeEntity;
#end

/**
 * ${functionName}对象 ${tableName}
 *
 * @author ${author}
 * @date ${datetime}
 */
#if($table.crud || $table.sub)
    #set($Entity="BaseEntity")
#elseif($table.tree)
    #set($Entity="TreeEntity<${ClassName}>")
#end
@Data
@EqualsAndHashCode(callSuper = true)
@TableName("${tableName}")
public class ${ClassName} extends ${Entity} {

    private static final long serialVersionUID=1L;

#foreach ($column in $columns)
## 方法排除基类Entity字段
#if(!$table.isSuperColumn($column.javaField))
    /**
     * $column.columnComment
     */
## 根据属性标识添加注解
#if($column.javaField=='delFlag')
    @TableLogic
#end
#if($column.javaField=='version')
    @Version
#end
#if($column.pk)
    @TableId(value = "$column.columnName")
#end
    private $column.javaType $column.javaField;
#end
#end

}
```

:::

**请求响应类 vm/java/vo.java.vm**

::: details 点击展开

```velocity {32-51}
package ${packageName}.domain.vo;

#foreach ($import in $importList)
import ${import};
#end
import com.alibaba.excel.annotation.ExcelIgnoreUnannotated;
import com.alibaba.excel.annotation.ExcelProperty;
import com.ruoyi.common.annotation.ExcelDictFormat;
import com.ruoyi.common.convert.ExcelDictConvert;
import lombok.Data;
import java.util.Date;

import java.io.Serializable;

/**
 * ${functionName}视图对象 ${tableName}
 *
 * @author ${author}
 * @date ${datetime}
 */
@Data
@ExcelIgnoreUnannotated
public class ${ClassName}Vo implements Serializable {

    private static final long serialVersionUID = 1L;

#foreach ($column in $columns)
#if($column.list)
    /**
     * $column.columnComment
     */
    ## 字段内容获取括号中了，如果没有则直接显示
    #set($parentheseIndex=$column.columnComment.indexOf("（"))
    #if($parentheseIndex != -1)
        #set($comment=$column.columnComment.substring(0, $parentheseIndex))
    #else
        #set($comment=$column.columnComment)
    #end
    ## 导出表格处理
    #if(${column.dictType} && ${column.dictType} != '')
        ## 为字典类型 转化处理
    @ExcelProperty(value = "${comment}" , converter = ExcelDictConvert.class)
    @ExcelDictFormat(dictType = "${column.dictType}" )
    #elseif($parentheseIndex != -1)
        ## 为字典类型处理 (特殊转化处理)
    @ExcelProperty(value = "${comment}" , converter = ExcelDictConvert.class)
    @ExcelDictFormat(readConverterExp = "$column.readConverterExp()" )
    #else
        ## 默认 导出不处理 仅做标识
    @ExcelProperty(value = "${comment}" )
    #end
    private $column.javaType $column.javaField;

#end
#end

}
```

:::

**请求接收类 vm/java/bo.java.vm**

::: details 点击展开

```velocity {37-60}
package ${packageName}.domain.bo;

import com.ruoyi.common.core.validate.AddGroup;
import com.ruoyi.common.core.validate.EditGroup;
import lombok.Data;
import lombok.EqualsAndHashCode;

import javax.validation.constraints.*;

import java.util.Date;

#foreach ($import in $importList)
import ${import};
#end
#if($table.crud || $table.sub)
import com.ruoyi.common.core.domain.BaseEntity;
#elseif($table.tree)
import com.ruoyi.common.core.domain.TreeEntity;
#end

/**
 * ${functionName}业务对象 ${tableName}
 *
 * @author ${author}
 * @date ${datetime}
 */
#if($table.crud || $table.sub)
    #set($Entity="BaseEntity")
#elseif($table.tree)
    #set($Entity="TreeEntity<${ClassName}Bo>")
#end

@Data
@EqualsAndHashCode(callSuper = true)
public class ${ClassName}Bo extends ${Entity} {

    #foreach ($column in $columns)
        ## 额外判断请求参数非空处理
        #if(!$table.isSuperColumn($column.javaField) && ($column.query || $column.insert || $column.edit))
            /**
             * $column.columnComment
             */
            ## 判断含有的操作组控制非空校验
            #if($column.insert && $column.edit)
                #set($Group="AddGroup.class, EditGroup.class")
            #elseif($column.insert)
                #set($Group="AddGroup.class")
            #elseif($column.edit)
                #set($Group="EditGroup.class")
            #end
            #if($column.required)
                ## 区分对象字符串处理
                #if($column.javaType == 'String')
        @NotBlank(message = "$column.columnComment不能为空" , groups = { $Group })
                #else
        @NotNull(message = "$column.columnComment不能为空" , groups = { $Group })
                #end
            #end
        private $column.javaType $column.javaField;

        #end
    #end

}
```

:::

**业务接口 vm/java/service.java.vm** (无核心业务代码)

::: details 点击展开

```velocity
package ${packageName}.service;

import ${packageName}.domain.${ClassName};
import ${packageName}.domain.vo.${ClassName}Vo;
import ${packageName}.domain.bo.${ClassName}Bo;
    #if($table.crud || $table.sub)
    import com.ruoyi.common.core.page.TableDataInfo;
    import com.ruoyi.common.core.domain.PageQuery;
    #end

import java.util.Collection;
import java.util.List;

/**
 * ${functionName}Service接口
 *
 * @author ${author}
 * @date ${datetime}
 */
public interface I${ClassName}Service {

    /**
     * 查询${functionName}
     */
        ${ClassName}Vo queryById(${pkColumn.javaType} ${pkColumn.javaField});

    #if($table.crud || $table.sub)
        /**
         * 查询${functionName}列表
         */
        TableDataInfo<${ClassName}Vo> queryPageList(${ClassName}Bo bo, PageQuery pageQuery);
    #end

    /**
     * 查询${functionName}列表
     */
    List<${ClassName}Vo> queryList(${ClassName}Bo bo);

    /**
     * 新增${functionName}
     */
    Boolean insertByBo(${ClassName}Bo bo);

    /**
     * 修改${functionName}
     */
    Boolean updateByBo(${ClassName}Bo bo);

    /**
     * 校验并批量删除${functionName}信息
     */
    Boolean deleteWithValidByIds(Collection<${pkColumn.javaType}> ids, Boolean isValid);
}
```

:::

**业务实现类 vm/java/serviceImpl.java.vm**

::: details 点击展开

主要业务还得是 buildQueryWrapper()方法，约束查询的构建

```velocity {64-92}
package ${packageName}.service.impl;

import cn.hutool.core.bean.BeanUtil;
import com.ruoyi.common.utils.StringUtils;
    #if($table.crud || $table.sub)
    import com.ruoyi.common.core.page.TableDataInfo;
    import com.ruoyi.common.core.domain.PageQuery;
    import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
    #end
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.baomidou.mybatisplus.core.toolkit.Wrappers;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import ${packageName}.domain.bo.${ClassName}Bo;
import ${packageName}.domain.vo.${ClassName}Vo;
import ${packageName}.domain.${ClassName};
import ${packageName}.mapper.${ClassName}Mapper;
import ${packageName}.service.I${ClassName}Service;

import java.util.List;
import java.util.Map;
import java.util.Collection;

/**
 * ${functionName}Service业务层处理
 *
 * @author ${author}
 * @date ${datetime}
 */
@RequiredArgsConstructor
@Service
public class ${ClassName}ServiceImpl implements I${ClassName}Service {

    private final ${ClassName}Mapper baseMapper;

    /**
     * 查询${functionName}
     */
    @Override
    public ${ClassName}Vo queryById(${pkColumn.javaType} ${pkColumn.javaField}) {
        return baseMapper.selectVoById(${pkColumn.javaField});
    }

    #if($table.crud || $table.sub)
        /**
         * 查询${functionName}列表
         */
        @Override
        public TableDataInfo<${ClassName}Vo> queryPageList(${ClassName}Bo bo, PageQuery pageQuery) {
            LambdaQueryWrapper<${ClassName}> lqw = buildQueryWrapper(bo);
            Page<${ClassName}Vo> result = baseMapper.selectVoPage(pageQuery.build(), lqw);
            return TableDataInfo.build(result);
        }
    #end

    /**
     * 查询${functionName}列表
     */
    @Override
    public List<${ClassName}Vo> queryList(${ClassName}Bo bo) {
        LambdaQueryWrapper<${ClassName}> lqw = buildQueryWrapper(bo); return baseMapper.selectVoList(lqw);
    }

    ## 构建查询条件
    private LambdaQueryWrapper<${ClassName}> buildQueryWrapper(${ClassName}Bo bo) {
        Map<String, Object> params = bo.getParams();
        LambdaQueryWrapper<${ClassName}> lqw = Wrappers.lambdaQuery();
        #foreach($column in $columns)
            #if($column.query)
                #set($queryType=$column.queryType)
                #set($javaField=$column.javaField)
                #set($javaType=$column.javaType)
                #set($columnName=$column.columnName)
                #set($AttrName=$column.javaField.substring(0,1).toUpperCase() + ${column.javaField.substring(1)})
                #set($mpMethod=$column.queryType.toLowerCase())
                #if($queryType != 'BETWEEN')
                    ## 查询判空
                    #if($javaType == 'String')
                        #set($condition='StringUtils.isNotBlank(bo.get'+$AttrName+'())')
                    #else
                        #set($condition='bo.get'+$AttrName+'() != null')
                    #end
                    lqw.$mpMethod($condition, ${ClassName}::get$AttrName, bo.get$AttrName());
                #else
                    ## 日期范围单独处理
                    lqw.between(params.get("begin$AttrName" ) != null && params.get("end$AttrName" ) != null,
                        ${ClassName}::get$AttrName , params.get("begin$AttrName" ), params.get("end$AttrName" ));
                #end
            #end
        #end
        return lqw;
    }

    /**
     * 新增${functionName}
     */
    @Override
    public Boolean insertByBo(${ClassName}Bo bo) {
        ${ClassName} add = BeanUtil.toBean(bo, ${ClassName}. class);
        validEntityBeforeSave(add);
        boolean flag = baseMapper.insert(add) > 0;
        #set($pk=$pkColumn.javaField.substring(0,1).toUpperCase() + ${pkColumn.javaField.substring(1)})
        if (flag) {
            bo.set$pk(add.get$pk());
        }
        return flag;
    }

    /**
     * 修改${functionName}
     */
    @Override
    public Boolean updateByBo(${ClassName}Bo bo) {
        ${ClassName} update = BeanUtil.toBean(bo, ${ClassName}. class);
        validEntityBeforeSave(update);
        return baseMapper.updateById(update) > 0;
    }

    /**
     * 保存前的数据校验
     */
    private void validEntityBeforeSave(${ClassName} entity) {
        //TODO 做一些数据校验,如唯一约束
    }

    /**
     * 批量删除${functionName}
     */
    @Override
    public Boolean deleteWithValidByIds(Collection<${pkColumn.javaType}> ids, Boolean isValid) {
        if (isValid) {
            //TODO 做一些业务上的校验,判断是否需要校验
        }
        return baseMapper.deleteBatchIds(ids) > 0;
    }
}
```

:::

**控制器 vm/java/controller.java.vm** (无核心业务代码)

::: details 点击展开

```velocity
package ${packageName}.controller;

import java.util.List;
import java.util.Arrays;
import java.util.concurrent.TimeUnit;

import lombok.RequiredArgsConstructor;

import javax.servlet.http.HttpServletResponse;
import javax.validation.constraints.*;

import cn.dev33.satoken.annotation.SaCheckPermission;
import org.springframework.web.bind.annotation.*;
import org.springframework.validation.annotation.Validated;
import com.ruoyi.common.annotation.RepeatSubmit;
import com.ruoyi.common.annotation.Log;
import com.ruoyi.common.core.controller.BaseController;
import com.ruoyi.common.core.domain.PageQuery;
import com.ruoyi.common.core.domain.R;
import com.ruoyi.common.core.validate.AddGroup;
import com.ruoyi.common.core.validate.EditGroup;
import com.ruoyi.common.core.validate.QueryGroup;
import com.ruoyi.common.enums.BusinessType;
import com.ruoyi.common.utils.poi.ExcelUtil;
import ${packageName}.domain.vo.${ClassName}Vo;
import ${packageName}.domain.bo.${ClassName}Bo;
import ${packageName}.service.I${ClassName}Service;
#if($table.crud || $table.sub)
import com.ruoyi.common.core.page.TableDataInfo;
#elseif($table.tree)
#end

/**
 * ${functionName}
 *
 * @author ${author}
 * @date ${datetime}
 */
@Validated
@RequiredArgsConstructor
@RestController
@RequestMapping("/${moduleName}/${businessName}" )
public class ${ClassName}Controller extends BaseController {

    private final I${ClassName}Service i${ClassName}Service;

/**
 * 查询${functionName}列表
 */
@SaCheckPermission("${permissionPrefix}:list" )
@GetMapping("/list" )
    #if($table.crud || $table.sub)
    public TableDataInfo<${ClassName}Vo> list(${ClassName}Bo bo, PageQuery pageQuery) {
        return i${ClassName}Service.queryPageList(bo, pageQuery);
    }
    #elseif($table.tree)
        public R<List<${ClassName}Vo>> list(${ClassName}Bo bo) {
            List<${ClassName}Vo> list = i${ClassName}Service.queryList(bo);
            return R.ok(list);
        }
    #end

    /**
     * 导出${functionName}列表
     */
    @SaCheckPermission("${permissionPrefix}:export" )
    @Log(title = "${functionName}" , businessType = BusinessType.EXPORT)
    @PostMapping("/export" )
    public void export(${ClassName}Bo bo, HttpServletResponse response) {
        List<${ClassName}Vo> list = i${ClassName}Service.queryList(bo);
        ExcelUtil.exportExcel(list, "${functionName}" , ${ClassName}Vo.class, response);
    }

    /**
     * 获取${functionName}详细信息
     *
     * @param ${pkColumn.javaField} 主键
     */
    @SaCheckPermission("${permissionPrefix}:query" )
    @GetMapping("/{${pkColumn.javaField}}" )
    public R<${ClassName}Vo> getInfo(@NotNull(message = "主键不能为空" ) @PathVariable ${pkColumn.javaType} ${pkColumn.javaField}) {
        return R.ok(i${ClassName}Service.queryById(${pkColumn.javaField}));
    }

    /**
     * 新增${functionName}
     */
    @SaCheckPermission("${permissionPrefix}:add" )
    @Log(title = "${functionName}" , businessType = BusinessType.INSERT)
    @RepeatSubmit()
    @PostMapping()
    public R<Void> add(@Validated(AddGroup.class) @RequestBody ${ClassName}Bo bo) {
        return toAjax(i${ClassName}Service.insertByBo(bo));
    }

    /**
     * 修改${functionName}
     */
    @SaCheckPermission("${permissionPrefix}:edit" )
    @Log(title = "${functionName}" , businessType = BusinessType.UPDATE)
    @RepeatSubmit()
    @PutMapping()
    public R<Void> edit(@Validated(EditGroup.class) @RequestBody ${ClassName}Bo bo) {
        return toAjax(i${ClassName}Service.updateByBo(bo));
    }

    /**
     * 删除${functionName}
     *
     * @param ${pkColumn.javaField}s 主键串
     */
    @SaCheckPermission("${permissionPrefix}:remove" )
    @Log(title = "${functionName}" , businessType = BusinessType.DELETE)
    @DeleteMapping("/{${pkColumn.javaField}s}" )
    public R<Void> remove(@NotEmpty(message = "主键不能为空" ) @PathVariable ${pkColumn.javaType}[] ${pkColumn.javaField}s) {
        return toAjax(i${ClassName}Service.deleteWithValidByIds(Arrays.asList(${pkColumn.javaField}s), true));
    }
}
```

:::

### XML模块

**Mapper接口 vm/java/mapper.java.vm** (无核心业务代码)

::: details 点击展开

```velocity
package ${packageName}.mapper;

import ${packageName}.domain.${ClassName};
import ${packageName}.domain.vo.${ClassName}Vo;
import com.ruoyi.common.core.mapper.BaseMapperPlus;

/**
 * ${functionName}Mapper接口
 *
 * @author ${author}
 * @date ${datetime}
 */
public interface ${ClassName}Mapper extends BaseMapperPlus<${ClassName}Mapper, ${ClassName}, ${ClassName}Vo> {

}
```

:::

**XML映射文件 vm/xml/mapper.xml.vm** (无核心业务代码)

::: details 点击展开

```velocity
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="${packageName}.mapper.${ClassName}Mapper">

    <resultMap type="${packageName}.domain.${ClassName}" id="${ClassName}Result">
    #foreach ($column in $columns)
    	<result property="${column.javaField}" column="${column.columnName}"/>
    #end
    </resultMap>


</mapper>
```

:::

### SQL模板

**菜单和权限SQL vm/sql/sql.vm**

::: details 点击展开

```velocity
-- 菜单 SQL
insert into sys_menu (menu_id, menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
values(${table.menuIds[0]}, '${functionName}', '${parentMenuId}', '1', '${businessName}', '${moduleName}/${businessName}/index', 1, 0, 'C', '0', '0', '${permissionPrefix}:list', '#', 'admin', sysdate(), '', null, '${functionName}菜单');

-- 按钮 SQL
insert into sys_menu (menu_id, menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
values(${table.menuIds[1]}, '${functionName}查询', ${table.menuIds[0]}, '1',  '#', '', 1, 0, 'F', '0', '0', '${permissionPrefix}:query',        '#', 'admin', sysdate(), '', null, '');

insert into sys_menu (menu_id, menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
values(${table.menuIds[2]}, '${functionName}新增', ${table.menuIds[0]}, '2',  '#', '', 1, 0, 'F', '0', '0', '${permissionPrefix}:add',          '#', 'admin', sysdate(), '', null, '');

insert into sys_menu (menu_id, menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
values(${table.menuIds[3]}, '${functionName}修改', ${table.menuIds[0]}, '3',  '#', '', 1, 0, 'F', '0', '0', '${permissionPrefix}:edit',         '#', 'admin', sysdate(), '', null, '');

insert into sys_menu (menu_id, menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
values(${table.menuIds[4]}, '${functionName}删除', ${table.menuIds[0]}, '4',  '#', '', 1, 0, 'F', '0', '0', '${permissionPrefix}:remove',       '#', 'admin', sysdate(), '', null, '');

insert into sys_menu (menu_id, menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, update_by, update_time, remark)
values(${table.menuIds[5]}, '${functionName}导出', ${table.menuIds[0]}, '5',  '#', '', 1, 0, 'F', '0', '0', '${permissionPrefix}:export',       '#', 'admin', sysdate(), '', null, '');

```

:::

## 相关文档

- [代码生成 - 核心业务](./01.代码生成-核心业务.md)
- [代码生成 - 配置示例](./03.代码生成-配置示例.md)