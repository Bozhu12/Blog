---
title: ruoyi-vue-plus 代码生成功能 - 配置示例
date: 2023-12-09 21:29:46
author: 柏竹
permalink: /ruoyi-vue-plus/8/config-examples
categories: 
  - 后端
  - 框架
tags: 
  - ruoyi-vue-plus
  - 代码生成
  - 配置
---

## 配置文件

**`generator.yml` 配置文件**

```yml
# 代码生成
gen: 
  # 作者
  author: bozhu
  # 默认生成包路径 system 需改成自己的模块名称 如 system monitor tool
  packageName: com.ruoyi.system
  # 自动去除表前缀，默认是false
  autoRemovePre: false
  # 表前缀（生成类名不会包含表前缀，多个用逗号分隔）
  tablePrefix: sys_
```

> 根据实际情况修改配置

## GenUtils 代码生成工具类

**`DataBaseHelper`数据源判断**

::: details 点击展开

```java
@NoArgsConstructor(access = AccessLevel.PRIVATE)
public class DataBaseHelper {

    private static final DynamicRoutingDataSource DS = SpringUtils.getBean(DynamicRoutingDataSource.class);

    /**
     * 获取当前数据库类型
     */
    public static DataBaseType getDataBaseType() {
        DataSource dataSource = DS.determineDataSource();
        try (Connection conn = dataSource.getConnection()) {
            DatabaseMetaData metaData = conn.getMetaData();
            String databaseProductName = metaData.getDatabaseProductName();
            return DataBaseType.find(databaseProductName);
        } catch (SQLException e) {
            throw new ServiceException(e.getMessage());
        }
    }

    public static boolean isMySql() {
        return DataBaseType.MY_SQL == getDataBaseType();
    }

    public static boolean isOracle() {
        return DataBaseType.ORACLE == getDataBaseType();
    }

    public static boolean isPostgerSql() {
        return DataBaseType.POSTGRE_SQL == getDataBaseType();
    }

    public static boolean isSqlServer() {
        return DataBaseType.SQL_SERVER == getDataBaseType();
    }

    public static String findInSet(Object var1, String var2) {
        DataBaseType dataBasyType = getDataBaseType();
        String var = Convert.toStr(var1);
        if (dataBasyType == DataBaseType.SQL_SERVER) {
            // charindex(',100,' , ',0,100,101,') <> 0
            return "charindex('," + var + ",' , ','+" + var2 + "+',') <> 0";
        } else if (dataBasyType == DataBaseType.POSTGRE_SQL) {
            // (select position(',100,' in ',0,100,101,')) <> 0
            return "(select position('," + var + ",' in ','||" + var2 + "||',')) <> 0";
        } else if (dataBasyType == DataBaseType.ORACLE) {
            // instr(',0,100,101,' , ',100,') <> 0
            return "instr(','||" + var2 + "||',' , '," + var + ",') <> 0";
        }
        // find_in_set('100' , '0,100,101')
        return "find_in_set('" + var + "' , " + var2 + ") <> 0";
    }
}
```

:::

**GenUtils 核心工具类**

::: details 点击展开

初始化表信息 *GenUtils#initTable()*

```java
public static void initTable(GenTable genTable, String operName) {
    genTable.setClassName(convertClassName(genTable.getTableName()));
    genTable.setPackageName(GenConfig.getPackageName());
    genTable.setModuleName(getModuleName(GenConfig.getPackageName()));
    genTable.setBusinessName(getBusinessName(genTable.getTableName()));
    genTable.setFunctionName(replaceText(genTable.getTableComment()));
    genTable.setFunctionAuthor(GenConfig.getAuthor());
    genTable.setCreateBy(operName);
}
```

初始化字段属性 *GenUtils#initColumnField()*

```java
public static void initColumnField(GenTableColumn column, GenTable table) {
    // 括号处理
    String dataType = getDbType(column.getColumnType());
    String columnName = column.getColumnName();
    column.setTableId(table.getTableId());
    column.setCreateBy(table.getCreateBy());
    // 设置java字段名 (驼峰处理)
    column.setJavaField(StringUtils.toCamelCase(columnName));
    // 设置默认类型
    column.setJavaType(GenConstants.TYPE_STRING);
    // 设置默认查询条件
    column.setQueryType(GenConstants.QUERY_EQ);

    // 数据类型处理
    if (arraysContains(GenConstants.COLUMNTYPE_STR, dataType) || arraysContains(GenConstants.COLUMNTYPE_TEXT, dataType)) {
        // 文本类型处理
        // 字符串长度超过500设置为文本域
        Integer columnLength = getColumnLength(column.getColumnType());
        String htmlType = columnLength >= 500 || arraysContains(GenConstants.COLUMNTYPE_TEXT, dataType) ? GenConstants.HTML_TEXTAREA : GenConstants.HTML_INPUT;
        column.setHtmlType(htmlType);
    } else if (arraysContains(GenConstants.COLUMNTYPE_TIME, dataType)) {
        // 时间类型处理
        column.setJavaType(GenConstants.TYPE_DATE);
        column.setHtmlType(GenConstants.HTML_DATETIME);
    } else if (arraysContains(GenConstants.COLUMNTYPE_NUMBER, dataType)) {
        // 数值类型处理
        column.setHtmlType(GenConstants.HTML_INPUT);

        // 如果是浮点型 统一用BigDecimal
        String[] str = StringUtils.split(StringUtils.substringBetween(column.getColumnType(), "(", ")"), StringUtils.SEPARATOR);
        if (str != null && str.length == 2 && Integer.parseInt(str[1]) > 0) {
            // 浮点型
            column.setJavaType(GenConstants.TYPE_BIGDECIMAL);
        } else if (str != null && str.length == 1 && Integer.parseInt(str[0]) <= 10) {
            // 整型
            column.setJavaType(GenConstants.TYPE_INTEGER);
        } else {
            // 长整型
            column.setJavaType(GenConstants.TYPE_LONG);
        }
    }

    // BO对象 默认插入勾选
    if (!arraysContains(GenConstants.COLUMNNAME_NOT_ADD, columnName) && !column.isPk()) {
        column.setIsInsert(GenConstants.REQUIRE);
    }
    // BO对象 默认编辑勾选
    if (!arraysContains(GenConstants.COLUMNNAME_NOT_EDIT, columnName)) {
        column.setIsEdit(GenConstants.REQUIRE);
    }
    // BO对象 默认是否必填勾选
    if (!arraysContains(GenConstants.COLUMNNAME_NOT_EDIT, columnName)) {
        column.setIsRequired(GenConstants.REQUIRE);
    }
    // VO对象 默认返回勾选
    if (!arraysContains(GenConstants.COLUMNNAME_NOT_LIST, columnName)) {
        column.setIsList(GenConstants.REQUIRE);
    }
    // BO对象 默认查询勾选
    if (!arraysContains(GenConstants.COLUMNNAME_NOT_QUERY, columnName) && !column.isPk()) {
        column.setIsQuery(GenConstants.REQUIRE);
    }

    // 固有字段控制
    // 查询字段类型
    if (StringUtils.endsWithIgnoreCase(columnName, "name")) {
        column.setQueryType(GenConstants.QUERY_LIKE);
    }
    // 状态字段设置单选框
    if (StringUtils.endsWithIgnoreCase(columnName, "status")) {
        column.setHtmlType(GenConstants.HTML_RADIO);
    }
    // 类型&性别字段设置下拉框
    else if (StringUtils.endsWithIgnoreCase(columnName, "type")
        || StringUtils.endsWithIgnoreCase(columnName, "sex")) {
        column.setHtmlType(GenConstants.HTML_SELECT);
    }
    // 图片字段设置图片上传控件
    else if (StringUtils.endsWithIgnoreCase(columnName, "image")) {
        column.setHtmlType(GenConstants.HTML_IMAGE_UPLOAD);
    }
    // 文件字段设置文件上传控件
    else if (StringUtils.endsWithIgnoreCase(columnName, "file")) {
        column.setHtmlType(GenConstants.HTML_FILE_UPLOAD);
    }
    // 内容字段设置富文本控件
    else if (StringUtils.endsWithIgnoreCase(columnName, "content")) {
        column.setHtmlType(GenConstants.HTML_EDITOR);
    }
}
```

:::

## 数据库查询 SQL 详解

**获取表字段信息，SQL执行语句 GenTableColumnMapper.selectDbTableColumnsByName()**

::: details 点击展开 - MySQL 版本

```xml
<select id="selectDbTableColumnsByName" parameterType="String" resultMap="GenTableColumnResult">
    select column_name,
           (case when (is_nullable = 'no' <![CDATA[ && ]]> column_key != 'PRI') then '1' else '0' end) as is_required,
           (case when column_key = 'PRI' then '1' else '0' end) as is_pk,
           ordinal_position as sort,
           column_comment,
           (case when extra = 'auto_increment' then '1' else '0' end) as is_increment,
           column_type
    from information_schema.columns where table_schema = (select database()) and table_name = (#{tableName})
    order by ordinal_position
</select>
```

实际执行SQL

```sql
SELECT
	column_name,
	# 判断列是否必要的 (为空并且不是主键)
	( CASE WHEN ( is_nullable = 'no' && column_key != 'PRI' ) THEN '1' ELSE '0' END ) AS is_required,
	# 判断是否为主键
	( CASE WHEN column_key = 'PRI' THEN '1' ELSE '0' END ) AS is_pk,
	ordinal_position AS sort,
	column_comment,
	# 判断是否自增
	( CASE WHEN extra = 'auto_increment' THEN '1' ELSE '0' END ) AS is_increment,
	column_type 
FROM
	information_schema.COLUMNS 
WHERE
	table_schema = (SELECT DATABASE()) 
	AND table_name = ( 'paper_test' ) 
ORDER BY
	ordinal_position
```

:::

**获取表信息，SQL执行语句 GenTableMapper.selectDbTableListByNames()**

::: details 点击展开 - MySQL 版本

```xml
<select id="selectDbTableListByNames" resultMap="GenTableResult">
    select table_name, table_comment, create_time, update_time from information_schema.tables
    where table_name NOT LIKE 'xxl_job_%' and table_name NOT LIKE 'gen_%' and table_schema = (select database())
    and table_name in
    <foreach collection="array" item="name" open="(" separator="," close=")">
         #{name}
    </foreach>
</select>
```

实际执行SQL (用法和上面一样)

```sql
SELECT
	table_name,
	table_comment,
	create_time,
	update_time 
FROM
	information_schema.TABLES 
WHERE
	table_name NOT LIKE 'xxl_job_%' 
	AND table_name NOT LIKE 'gen_%' 
	AND table_schema = (SELECT DATABASE()) 
	# 多个表名逗号分隔
	AND table_name IN ( 'tableName' )
```

:::

## 常量定义

**GenConstants 生成常量类**

::: details 点击展开

```java
/**
 * 代码生成通用常量
 */
public class GenConstants {
    /** 单表（增删改查） */
    public static final String TPL_CRUD = "crud";

    /** 树表（增删改查） */
    public static final String TPL_TREE = "tree";

    /** 主子表（增删改查） */
    public static final String TPL_SUB = "sub";

    /** 树编码字段 */
    public static final String TREE_CODE = "treeCode";

    /** 树父编码字段 */
    public static final String TREE_PARENT_CODE = "treeParentCode";

    /** 树名称字段 */
    public static final String TREE_NAME = "treeName";

    /** 上级菜单ID字段 */
    public static final String PARENT_MENU_ID = "parentMenuId";

    /** 上级菜单名称字段 */
    public static final String PARENT_MENU_NAME = "parentMenuName";

    /** 数据库字符串类型 */
    public static final String[] COLUMNTYPE_STR = { "char", "varchar", "nvarchar", "varchar2" };

    /** 数据库文本类型 */
    public static final String[] COLUMNTYPE_TEXT = { "tinytext", "text", "mediumtext", "longtext" };

    /** 数据库时间类型 */
    public static final String[] COLUMNTYPE_TIME = { "datetime", "time", "date", "timestamp" };

    /** 数据库数字类型 */
    public static final String[] COLUMNTYPE_NUMBER = { "tinyint", "smallint", "mediumint", "int", "number", "integer",
            "bit", "bigint", "float", "double", "decimal" };

    /** 页面不需要编辑字段 */
    public static final String[] COLUMNNAME_NOT_EDIT = { "id", "create_by", "create_time", "del_flag" };

    /** 页面不需要显示的列表字段 */
    public static final String[] COLUMNNAME_NOT_LIST = { "id", "create_by", "create_time", "del_flag", "update_by",
            "update_time" };

    /** 页面不需要查询字段 */
    public static final String[] COLUMNNAME_NOT_QUERY = { "id", "create_by", "create_time", "del_flag", "update_by",
            "update_time", "remark" };

    /** Entity基类字段 */
    public static final String[] BASE_ENTITY = { "createBy", "createTime", "updateBy", "updateTime", "remark" };

    /** Tree基类字段 */
    public static final String[] TREE_ENTITY = { "parentName", "parentId", "orderNum", "ancestors", "children" };

    /** 文本框 */
    public static final String HTML_INPUT = "input";

    /** 文本域 */
    public static final String HTML_TEXTAREA = "textarea";

    /** 下拉框 */
    public static final String HTML_SELECT = "select";

    /** 单选框 */
    public static final String HTML_RADIO = "radio";

    /** 复选框 */
    public static final String HTML_CHECKBOX = "checkbox";

    /** 日期控件 */
    public static final String HTML_DATETIME = "datetime";

    /** 图片上传控件 */
    public static final String HTML_IMAGE_UPLOAD = "imageUpload";

    /** 文件上传控件 */
    public static final String HTML_FILE_UPLOAD = "fileUpload";

    /** 富文本控件 */
    public static final String HTML_EDITOR = "editor";

    /** 字符串类型 */
    public static final String TYPE_STRING = "String";

    /** 整型 */
    public static final String TYPE_INTEGER = "Integer";

    /** 长整型 */
    public static final String TYPE_LONG = "Long";

    /** 浮点型 */
    public static final String TYPE_DOUBLE = "Double";

    /** 高精度计算类型 */
    public static final String TYPE_BIGDECIMAL = "BigDecimal";

    /** 时间类型 */
    public static final String TYPE_DATE = "Date";

    /** 模糊查询 */
    public static final String QUERY_LIKE = "LIKE";

    /** 相等查询 */
    public static final String QUERY_EQ = "EQ";

    /** 需要 */
    public static final String REQUIRE = "1";
}
```

:::

## 配置加载

**GenConfig 配置加载类**

::: details 点击展开

```java
/**
 * 读取代码生成相关配置
 */
@Component
@ConfigurationProperties(prefix = "gen")
public class GenConfig {
    /** 作者 */
    public static String author;

    /** 生成包路径 */
    public static String packageName;

    /** 自动去除表前缀，默认是false */
    public static boolean autoRemovePre;

    /** 表前缀(类名不会包含表前缀) */
    public static String tablePrefix;

    public static String getAuthor() {
        return author;
    }

    public void setAuthor(String author) {
        GenConfig.author = author;
    }

    public static String getPackageName() {
        return packageName;
    }

    public void setPackageName(String packageName) {
        GenConfig.packageName = packageName;
    }

    public static boolean getAutoRemovePre() {
        return autoRemovePre;
    }

    public void setAutoRemovePre(boolean autoRemovePre) {
        GenConfig.autoRemovePre = autoRemovePre;
    }

    public static String getTablePrefix() {
        return tablePrefix;
    }

    public void setTablePrefix(String tablePrefix) {
        GenConfig.tablePrefix = tablePrefix;
    }
}
```

:::

## 相关文档

- [代码生成 - 核心业务](./01.代码生成-核心业务.md)  
- [代码生成 - 模板详解](./02.代码生成-模板详解.md)