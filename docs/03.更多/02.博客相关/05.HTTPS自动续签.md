---
title: HTTPS自动续签
author: 柏竹
permalink: /blog/httpso
date: 2024-10-21 00:00:00
categories: 
  - 其他技术
  - 博客建站
  - VuePress
tags: 
  - HTTP
  - HTTPS
  - SSL证书
  - Docker
  - Nginx
  - 教程
---

## 前置说明

本次采用OHTTPS提供的docker-nginx容器实现自动续签功能 , 只需一次配置长期应用!

**官网 :** [https://www.ohttps.com](https://www.ohttps.com?invitationCode=5py6vrvmqgrnze13) 

> 如果觉得这篇文章对你有所启发和帮助 , 假如你也是首次接触 , 那边不妨点下上方链接注册 , 支持下博主!!!

::: tip

本次采用官方提供的 docker-nginx 方案实现 

:::

## 费用

费用放在前边 , 白嫖者勿扰!

**费用换算关系 :** `1RMB = 100额度` 

|                       |    自动更新    |    手动更新     |
| :-------------------: | :------------: | :-------------: |
|     **更新证书**      |     50额度     |     25额度      |
|     **部署证书**      |     50额度     |     25额度      |
| **单次更新 (三个月)** | 100额度 (1RMB) | 50额度 (0.5RMB) |
|     **一年周期**      | 400额度 , 4RMB | 200额度 , 2RMB  |

::: tip

通过上表可以发现自动化更新一年费用才4块 , 完全不需管理! (真香)

:::

## 搭建过程

1. 创建 泛域名 (略, 按流程走即可)
2. 创建部署节点 , docker-nginx类型 , 复制 令牌 和 节点id (配置用上)
3. 下载并上传资源 [https://www.123865.com/s/vw9uTd-H0Bad](https://www.123865.com/s/vw9uTd-H0Bad) (自行解压)
4. 配置 `ohttps-nginx-builder.sh` , 填写 令牌 和 节点id 
5. 执行 `sudo bash ohttps-nginx-builder.sh`安装
6. 配置 `nginx/conf`目录 所有配置文件都改一遍 证书id

```nginx
# 其中一部分
server {	
    listen 80;
    listen [::]:80;
    
    server_name www.bozhu12.cc;

    # https ssl配置
    listen 443 ssl;
    listen [::]:443 ssl;
    # TODO 必须填写上自己 证书id
    ssl_certificate      /etc/nginx/certificates/cert-z4kql8d194j82679/fullchain.cer;
    ssl_certificate_key  /etc/nginx/certificates/cert-z4kql8d194j82679/cert.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }
}
```

## 脚本 (选看)

脚本配置 ohttps-nginx-builder.sh , [其他部分点击跳转](/blog/1hg723/#目录架构) 

```sh
#!/bin/bash# 

# HTTPS 自动部署配合
# 部署节点id
PUSH_NODE_ID="push-xxxx"
# 部署节点令牌
PUSH_NODE_TOKEN="xxxx"

#获取脚本所在的目录
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

# 载入镜像
sudo docker load -i "$SCRIPT_DIR/images/ohttps-nginx.tar"

# 暴露参数
export COMPOSE_PROJECT_DIR=$SCRIPT_DIR
export COMPOSE_PROJECT_NGINX_IMAGE="ohttps/ohttps-nginx:latest"
export COMPOSE_PROJECT_PUSH_NODE_ID=$PUSH_NODE_ID
export COMPOSE_PROJECT_PUSH_NODE_TOKEN=$PUSH_NODE_TOKEN

# 部署
sudo -E docker-compose up -d web-nginx
#sudo -E docker-compose config
```







